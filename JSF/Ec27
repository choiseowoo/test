ì¢‹ì•„. ê·¸ëŸ¼ **ì‹¤ë¬´ì—ì„œ ë°”ë¡œ ê°€ì ¸ë‹¤ ì“¸ ìˆ˜ ìˆê²Œ**
ğŸ‘‰ **3ê°€ì§€ë¥¼ ìˆœì„œëŒ€ë¡œ, êµ¬ì²´ì ìœ¼ë¡œ** ì •ë¦¬í•´ ì¤„ê²Œìš”.

---

# â‘  ì§€ê¸ˆ ì½”ë“œ ê¸°ì¤€ â€œê·¸ëŒ€ë¡œâ€ ë¦¬íŒ©í† ë§ ì˜ˆ

(**getRealPath ì œê±° + EC2 ëŒ€ì‘, ìµœì†Œ ìˆ˜ì •**)

## ğŸ“Œ ê¸°ì¡´ ì½”ë“œ í˜•íƒœ (ì „í˜•ì ì¸ íŒ¨í„´)

```java
String path = getServletContext().getRealPath("/WEB-INF/conf/");
File dir = new File(path);

File[] files = dir.listFiles();
for (File f : files) {
    if (f.getName().endsWith(".xml")) {
        try (InputStream is = new FileInputStream(f)) {
            loadXml(is);
        }
    }
}
```

---

## âœ… ë¦¬íŒ©í† ë§ 1ë‹¨ê³„ (ë¶„ê¸° ì¶”ê°€ â€“ ìµœì†Œ ìˆ˜ì •)

```java
ServletContext ctx = getServletContext();

// ğŸ”´ ê¸°ì¡´ ì½”ë“œì˜ í•µì‹¬ ë¬¸ì œ ì§€ì 
String realPath = ctx.getRealPath("/WEB-INF/conf/");

if (realPath != null) {
    // ===== ë¡œì»¬ WildFly (exploded WAR) =====
    File dir = new File(realPath);
    File[] files = dir.listFiles((d, name) -> name.endsWith(".xml"));

    if (files != null) {
        for (File f : files) {
            try (InputStream is = new FileInputStream(f)) {
                loadXml(is);
            }
        }
    }

} else {
    // ===== AWS EC2 (ì••ì¶• WAR) =====
    // getRealPath ë¶ˆê°€ â†’ fallback
    String[] files = {
        "a.xml",
        "b.xml",
        "c.xml"
    };

    for (String name : files) {
        try (InputStream is =
             ctx.getResourceAsStream("/WEB-INF/conf/" + name)) {

            if (is == null) {
                throw new IllegalStateException("File not found: " + name);
            }
            loadXml(is);
        }
    }
}
```

âœ” ë¡œì»¬ ë™ì‘ ìœ ì§€
âœ” EC2 ëŒ€ì‘
âœ” ìˆ˜ì •ëŸ‰ ìµœì†Œ
âŒ íŒŒì¼ëª… í•˜ë“œì½”ë”©

---

# â‘¡ index íŒŒì¼ ë°©ì‹ (getRealPath **ì™„ì „ ì œê±°**)

> **WEB-INF ìœ ì§€í•˜ë©´ì„œ EC2/ë¡œì»¬ ê³µí†µìœ¼ë¡œ ì“°ëŠ” â€œìµœì„ ì±…â€**

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
/WEB-INF/conf/
 â”œ files.index
 â”œ a.xml
 â”œ b.xml
 â”” c.xml
```

---

## ğŸ“„ files.index ê·œì¹™

### âœ… ê·œì¹™

* UTF-8
* í•œ ì¤„ = íŒŒì¼ í•˜ë‚˜
* ìƒëŒ€ ê²½ë¡œ ê¸ˆì§€
* ì£¼ì„ í—ˆìš©(`#`)

### ì˜ˆì‹œ

```
# XML config list
a.xml
b.xml
c.xml
```

---

## âœ… Servlet ì½”ë“œ (ê¶Œì¥ ìµœì¢…í˜•)

```java
ServletContext ctx = getServletContext();

try (InputStream index =
     ctx.getResourceAsStream("/WEB-INF/conf/files.index")) {

    if (index == null) {
        throw new IllegalStateException("files.index not found");
    }

    try (BufferedReader br =
         new BufferedReader(new InputStreamReader(index, StandardCharsets.UTF_8))) {

        br.lines()
          .map(String::trim)
          .filter(l -> !l.isEmpty())
          .filter(l -> !l.startsWith("#"))
          .forEach(name -> {
              try (InputStream is =
                   ctx.getResourceAsStream("/WEB-INF/conf/" + name)) {

                  if (is == null) {
                      throw new IllegalStateException("XML not found: " + name);
                  }
                  loadXml(is);

              } catch (IOException e) {
                  throw new RuntimeException(e);
              }
          });
    }
}
```

âœ” getRealPath ì œê±°
âœ” EC2 / ë¡œì»¬ ì™„ì „ ë™ì¼
âœ” WAR êµ¬ì¡° ìœ ì§€
âœ” íŒŒì¼ ì¶”ê°€ ì‹œ indexë§Œ ìˆ˜ì •

---

# â‘¢ ì™¸ë¶€ config ì´ì „ ë‹¨ê³„ë³„ ê°€ì´ë“œ (ìš´ì˜ ì •ì„)

> **ìµœì¢…ì ìœ¼ë¡œ ê°€ì¥ ì•ˆì „í•œ êµ¬ì¡°**

---

## ğŸ”¹ STEP 1. ì™¸ë¶€ ë””ë ‰í† ë¦¬ ìƒì„± (EC2)

```bash
sudo mkdir -p /opt/app/conf
sudo chown wildfly:wildfly /opt/app/conf
```

```
/opt/app/conf/
 â”œ a.xml
 â”œ b.xml
 â”” c.xml
```

---

## ğŸ”¹ STEP 2. web.xml ì„¤ì •

```xml
<context-param>
    <param-name>conf.dir</param-name>
    <param-value>/opt/app/conf</param-value>
</context-param>
```

---

## ğŸ”¹ STEP 3. Servlet ì½”ë“œ

```java
ServletContext ctx = getServletContext();
String dirPath = ctx.getInitParameter("conf.dir");

Path dir = Paths.get(dirPath);

if (!Files.isDirectory(dir)) {
    throw new IllegalStateException("Config dir not found: " + dirPath);
}

try (Stream<Path> stream = Files.list(dir)) {
    stream
        .filter(p -> p.toString().endsWith(".xml"))
        .forEach(p -> {
            try (InputStream is = Files.newInputStream(p)) {
                loadXml(is);
            } catch (IOException e) {
                throw new RuntimeException(e);
            }
        });
}
```

---

## ğŸ”¹ STEP 4. ë¡œì»¬ ëŒ€ì‘

* Windows: `C:\app\conf`
* web.xmlë§Œ í™˜ê²½ë³„ë¡œ ë³€ê²½

---

# ğŸ”š ìµœì¢… ì„ íƒ ê°€ì´ë“œ

| ìƒí™©           | ì¶”ì²œ              |
| ------------ | --------------- |
| ë‹¹ì¥ EC2 ì—ëŸ¬ ì œê±° | **â‘  ë¶„ê¸° ë°©ì‹**     |
| êµ¬ì¡° ê¹”ë”        | **â‘¡ index ë°©ì‹**  |
| ìš´ì˜/í™•ì¥        | **â‘¢ ì™¸ë¶€ config** |

---

## í•œ ì¤„ ìš”ì•½

> **getRealPathëŠ” â€œë˜ë©´ ì“°ê³ , ì•ˆ ë˜ë©´ ë²„ë¦¬ëŠ” APIâ€**
>
> ğŸ‘‰ ì§€ê¸ˆì€ **index ë°©ì‹**ì´ ê°€ì¥ í˜„ì‹¤ì ì¸ ì¤‘ê°„ í•´ë²•
> ğŸ‘‰ ìµœì¢… ëª©ì ì§€ëŠ” **ì™¸ë¶€ config**

---

ë‹¤ìŒìœ¼ë¡œ ì›í•˜ë©´

* **í˜„ì¬ ì‹¤ì œ ì½”ë“œ ê·¸ëŒ€ë¡œ ë¶™ì—¬ì„œ 1:1 ë¦¬íŒ©í† ë§**
* **index íŒŒì¼ ìë™ ìƒì„± ìŠ¤í¬ë¦½íŠ¸**
* **ë³´ì•ˆ/ê¶Œí•œ ì„¤ì • ì²´í¬ë¦¬ìŠ¤íŠ¸**

ë°”ë¡œ ì´ì–´ì„œ í•´ì¤„ê²Œ.
