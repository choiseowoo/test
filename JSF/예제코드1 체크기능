ì¢‹ì•„ìš” ğŸ˜„ ê·¸ëŸ¬ë©´ ì§€ê¸ˆ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **ViewScoped Beanì—ì„œ ì•ˆì „í•˜ê²Œ XML ìºì‹± ì ìš© + Validator ë™ì‘** ì™„ì „ ì½”ë“œ ë§Œë“¤ì–´ ë“œë¦´ê²Œìš”.

---

## 1ï¸âƒ£ Controller (ViewScoped Bean + ìºì‹œ ì ìš©)

```java
import jakarta.faces.bean.ManagedBean;
import jakarta.faces.bean.ViewScoped;
import jakarta.xml.bind.JAXBContext;
import jakarta.xml.bind.Unmarshaller;
import java.io.File;
import java.io.Serializable;
import java.util.*;
import java.util.stream.Collectors;

@ManagedBean
@ViewScoped
public class ScreenController implements Serializable {

    private String screenId; // í˜„ì¬ ëˆŒë¦° ë²„íŠ¼(sysA/sysB)
    private Map<String, List<ItemDTO>> xmlCache = new HashMap<>(); // í™”ë©´IDë³„ XML ìºì‹œ
    private Map<String, String> values = new HashMap<>(); // ì…ë ¥ê°’ ì €ì¥

    // ë²„íŠ¼ í´ë¦­
    public void sysA() {
        screenId = "sysA";
        loadXml(screenId);
    }

    public void sysB() {
        screenId = "sysB";
        loadXml(screenId);
    }

    // XML ì½ê³  ìºì‹œì— ì €ì¥
    private void loadXml(String screenId) {
        // ì´ë¯¸ ìºì‹œì— ì¡´ì¬í•˜ë©´ ì½ì§€ ì•ŠìŒ
        if(xmlCache.containsKey(screenId)) return;

        try {
            JAXBContext context = JAXBContext.newInstance(DataDTO.class);
            Unmarshaller unmarshaller = context.createUnmarshaller();
            DataDTO data = (DataDTO) unmarshaller.unmarshal(new File("data.xml"));

            List<ItemDTO> items = data.getUsers().stream()
                    .filter(u -> u.getGroup().equals(screenId))
                    .flatMap(u -> u.getItems().stream())
                    .collect(Collectors.toList());

            xmlCache.put(screenId, items);
        } catch (Exception e) {
            throw new RuntimeException("XML ë¡œë“œ ì‹¤íŒ¨: " + screenId, e);
        }
    }

    // Getter
    public String getScreenId() { return screenId; }
    public Map<String, String> getValues() { return values; }
    public Map<String, List<ItemDTO>> getXmlCache() { return xmlCache; }
}
```

---

## 2ï¸âƒ£ Validator (component.getId() + value í™œìš©)

```java
import jakarta.faces.application.FacesMessage;
import jakarta.faces.component.UIComponent;
import jakarta.faces.context.FacesContext;
import jakarta.faces.validator.FacesValidator;
import jakarta.faces.validator.Validator;
import jakarta.faces.validator.ValidatorException;
import java.util.List;

@FacesValidator("itemValidator")
public class ItemValidator implements Validator<String> {

    @Override
    public void validate(FacesContext context, UIComponent component, String value) throws ValidatorException {

        // Controllerì—ì„œ í™”ë©´ID + ìºì‹œ ê°€ì ¸ì˜¤ê¸°
        ScreenController controller = context.getApplication()
                .evaluateExpressionGet(context, "#{screenController}", ScreenController.class);
        String screenId = controller.getScreenId();
        if(screenId == null) return;

        List<ItemDTO> items = controller.getXmlCache().get(screenId);
        if(items == null) return;

        // ì–´ë–¤ ì…ë ¥ë€ì¸ì§€ í™•ì¸
        String fieldId = component.getId();
        ItemDTO item = items.stream()
                            .filter(i -> i.getId().equals(fieldId))
                            .findFirst()
                            .orElse(null);
        if(item == null) return;

        // ì…ë ¥ê°’ ê²€ì¦
        if("English".equals(item.getType()) && !value.matches("^[A-Za-z]+$")) {
            throw new ValidatorException(new FacesMessage(item.getName() + "ì€(ëŠ”) ì˜ì–´ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤."));
        }
        if("EnglishAndA".equals(item.getType()) && !value.matches("^[A-Za-z0-9@.]+$")) {
            throw new ValidatorException(new FacesMessage(item.getName() + "ì€(ëŠ”) ì´ë©”ì¼ í˜•ì‹ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."));
        }
        if(value.length() > item.getLength()) {
            throw new ValidatorException(new FacesMessage(item.getName() + "ì€(ëŠ”) ìµœëŒ€ " + item.getLength() + "ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤."));
        }
    }
}
```

---

## 3ï¸âƒ£ XHTML

```xml
<h:form>
    <h:inputText id="name" value="#{screenController.values['name']}" validator="itemValidator"/>
    <h:message for="name" style="color:red"/>

    <h:inputText id="email" value="#{screenController.values['email']}" validator="itemValidator"/>
    <h:message for="email" style="color:red"/>

    <h:commandButton id="sysA" value="SYS A" action="#{screenController.sysA}"/>
    <h:commandButton id="sysB" value="SYS B" action="#{screenController.sysB}"/>
</h:form>
```

---

### ğŸ”¹ ë™ì‘ ìš”ì•½

1. ë²„íŠ¼ í´ë¦­ â†’ `screenId` ì„¸íŒ… + XML ì½ì–´ì„œ ìºì‹œ ì €ì¥ (`xmlCache`)
2. Validator í˜¸ì¶œ â†’ `screenId` ê¸°ì¤€ìœ¼ë¡œ ìºì‹œì—ì„œ DTO ê°€ì ¸ì™€ ì…ë ¥ê°’ ê²€ì¦
3. XML íŒŒì¼ì€ í•œ ë²ˆë§Œ ì½ê³ , ì´í›„ ë™ì¼ í™”ë©´IDëŠ” ë©”ëª¨ë¦¬ì—ì„œ ì¡°íšŒ â†’ ë¹ ë¥¸ ê²€ì¦ ê°€ëŠ¥

---

ì´ êµ¬ì¡°ë©´ **Ajax ì—†ì´ë„ í™”ë©´ë³„(sysA/sysB) ì¡°ê±´ ì²´í¬ + XML ìºì‹±** ì™„ë²½í•˜ê²Œ ì ìš©ë©ë‹ˆë‹¤.

ì›í•˜ì‹œë©´ ì œê°€ **XML ë³€ê²½ ì‹œ ìºì‹œ ê°±ì‹  ê¸°ëŠ¥**ê¹Œì§€ ì¶”ê°€í•œ ë²„ì „ë„ ë§Œë“¤ì–´ì„œ ë³´ì—¬ë“œë¦´ ìˆ˜ ìˆì–´ìš”.
í˜¹ì‹œ ê·¸ê±° í•„ìš”í•˜ì‹ ê°€ìš”?
